#!/bin/bash

# --- –ì–æ–ª–æ–≤–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç—É ---
if [ -z "$1" ]; then
    echo "–ü–æ–º–∏–ª–∫–∞: –ù–µ–æ–±—Ö—ñ–¥–Ω–æ –≤–∫–∞–∑–∞—Ç–∏ –∞—Ä–≥—É–º–µ–Ω—Ç (—à–ª—è—Ö –¥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –∞–±–æ –Ω–∞–∑–≤—É –ø–∞–∫–µ—Ç—É)."
    echo "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è 1 (–ü–æ—à—É–∫ —Ñ–∞–π–ª—ñ–≤): $0 <–®–õ–Ø–•/–î–û/–î–ò–†–ï–ö–¢–û–†–Ü–á>"
    echo "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è 2 (–Ü–Ω—Å—Ç–∞–ª—è—Ü—ñ—è –ø–∞–∫–µ—Ç—É): $0 <–ù–ê–ó–í–ê_–ü–ê–ö–ï–¢–£>"
    exit 1
fi

ARGUMENT="$1"

# --- 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ —î –∞—Ä–≥—É–º–µ–Ω—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—î—é (–ó–∞–≤–¥–∞–Ω–Ω—è 2) ---
if [ -d "$ARGUMENT" ]; then
    
    echo "--- üïµÔ∏è‚Äç‚ôÇÔ∏è –ó–∞–≤–¥–∞–Ω–Ω—è 2: –ü–æ—à—É–∫ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ ---"
    
    TARGET_DIR="$ARGUMENT"

    echo "–ü–æ—à—É–∫ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ —É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó: ${TARGET_DIR}..."

    # –ó–Ω–∞–π—Ç–∏ –≤—Å—ñ –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ —Ñ–∞–π–ª–∏/–¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó, –≤–∏–∫–ª—é—á–∏–≤—à–∏ '.' —Ç–∞ '..'
    HIDDEN_ITEMS=$(find "$TARGET_DIR" -maxdepth 1 -name '.*' \( -type f -o -type d \) -print | grep -v -E '/(\.|\.\.)$')
    COUNT=$(echo "$HIDDEN_ITEMS" | wc -l)

    if [ "$COUNT" -gt 0 ]; then
        echo "‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ **${COUNT}** –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤:"
        echo "$HIDDEN_ITEMS"
    else
        echo "‚ÑπÔ∏è –ü—Ä–∏—Ö–æ–≤–∞–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ."
    fi

# --- 2. –Ø–∫—â–æ –∞—Ä–≥—É–º–µ–Ω—Ç –Ω–µ —î –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—î—é, –≤–≤–∞–∂–∞—î–º–æ, —â–æ —Ü–µ –ø–∞–∫–µ—Ç (–ó–∞–≤–¥–∞–Ω–Ω—è 3) ---
else
    
    echo "--- üì¶ –ó–∞–≤–¥–∞–Ω–Ω—è 3: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–∞ —ñ–Ω—Å—Ç–∞–ª—è—Ü—ñ—è –ø–∞–∫–µ—Ç—É ---"

    PACKAGE_NAME="$ARGUMENT"

    if dpkg -s "$PACKAGE_NAME" >/dev/null 2>&1 && dpkg -s "$PACKAGE_NAME" | grep -q "Status: install ok installed"; then
        echo "‚úÖ –ü–∞–∫–µ—Ç **${PACKAGE_NAME}** –≤–∂–µ **–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π**."
    else
        echo "‚ùå –ü–∞–∫–µ—Ç **${PACKAGE_NAME}** **–Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π**."

        if command -v apt >/dev/null 2>&1; then
            
            echo "–ó–∞–ø—É—Å–∫ —ñ–Ω—Å—Ç–∞–ª—è—Ü—ñ—ó. –ù–µ–æ–±—Ö—ñ–¥–Ω–æ sudo-–ø—Ä–∞–≤–∞..."
            
            if sudo apt update && sudo apt install -y "$PACKAGE_NAME"; then
                echo "‚úÖ –ü–∞–∫–µ—Ç **${PACKAGE_NAME}** —É—Å–ø—ñ—à–Ω–æ **–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ**."
            else
                echo "‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —ñ–Ω—Å—Ç–∞–ª—è—Ü—ñ—ó –ø–∞–∫–µ—Ç—É **${PACKAGE_NAME}**."
            fi
        else
            echo "–ü–æ–º–∏–ª–∫–∞: –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç—ñ–≤ 'apt' –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ."
        fi
    fi
fi

exit 0
